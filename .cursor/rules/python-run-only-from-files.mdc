---
alwaysApply: true
---
Python запускать только из файлов (PhotoSorter)

## Цель
Минимизировать зависания терминалов/REPL и экономить время/токены: никакого inline‑Python в PowerShell.

## ⚠️ ВАЖНО: Проблема с терминалом Cursor

**Известная проблема:** Выполнение команд Python в терминале Cursor может вызывать Connection Error и ломать текущий чат и все новые чаты. Старые чаты продолжают работать.

**Причина:** Конфликт Shell Integration Cursor с выводом Python команд. Точная причина не выяснена, проблема возникает в произвольный момент, воспроизведения нет.

**Решение:**
- Shell Integration отключена в `.vscode/settings.json` (`terminal.integrated.shellIntegration.enabled: false`)
- Это уменьшает частоту проблем, но не устраняет полностью

**Workaround при поломке терминала:**
1. Закрыть Cursor полностью
2. Удалить `%APPDATA%\Cursor\User\workspaceStorage\` (очистка битых настроек)
3. Запустить Cursor на чистую
4. Если работали над планом:
   - Стартовать нового агента
   - Попросить прочитать:
     - `.cursor/plans/` (все планы)
     - `docs/README.md`
     - Конкретный план (если был активен)
     - Правила из `.cursor/rules/`
   - Попросить продолжить план с отметкой прогресса

**Профилактика:**
- Все крупные изменения агентов выполняются только через планы (`.cursor/plans/`)
- Агент при выполнении отмечает прогресс в плане
- Python команды выполняются только из файлов (не inline)

**Утилиты для диагностики:**
- `python backend/scripts/debug/diagnose_terminal_issue.py` — диагностика проблемы
- `python backend/scripts/debug/clean_terminal_settings.py --dry-run` — проверка битых настроек
- `python backend/scripts/debug/clean_terminal_settings.py` — очистка битых настроек терминала

## ЖЁСТКИЕ запреты
- НЕЛЬЗЯ использовать `python -c "..."`.
- НЕЛЬЗЯ использовать heredoc/редиректы вида `<<` (bash‑стиль) и любые попытки “вставить” python‑код прямо в PowerShell.
- НЕЛЬЗЯ уходить в Python REPL (`>>>`) для выполнения команд проекта. Если случайно попали в REPL — сразу выйти: `exit()`.

## Как ПРАВИЛЬНО
- Любая python‑операция выполняется **только** так:
  - `python path/to/script.py [args...]`

## Что делать вместо inline‑Python (шорткаты)
- Для просмотра последних прогонов (pipeline_run_id / face_run_id):
  - `python backend/scripts/debug/list_pipeline_runs.py --limit 15`
- Для разового SQL‑запроса (только из файла, read‑only):
  - `python backend/scripts/debug/sqlite_select.py --sql-file path/to/query.sql`
