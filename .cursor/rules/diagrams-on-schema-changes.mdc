---
alwaysApply: true
---
Диаграммы сущностей (AS-IS / TO-BE) — правило обновления (PhotoSorter)

## Цель
Держать диаграммы сущностей в актуальном состоянии при изменениях структуры БД и/или ключевых архитектурных решений (особенно вокруг распознавания лиц, дедупликации, инвентаря файлов).

## Когда обновлять диаграммы (ОБЯЗАТЕЛЬНО)
Обновляю `docs/diagrams/entities_as_is.puml` и/или `docs/diagrams/entities_to_be.puml`, если менялось что-то из списка:
- добавили/изменили таблицы/колонки/индексы SQLite (файлы `DB/db.py`, миграции, новые модули хранилищ)
- поменяли смысл сущностей/связей (например, как хранится привязка лица к персоне, presence_score, anchors)
- приняли новое “устройство” модуля (новые flow/модули, разделение окружений и т.п.)

## Как обновлять PNG
После правки `.puml` перегенерирую PNG-картинки:

```powershell
python scripts/render_diagrams.py --in-dir docs/diagrams
```

Проверяю, что обновились файлы:
- `docs/diagrams/entities_as_is.png`
- `docs/diagrams/entities_to_be.png`

## Git-правило
PNG **коммитим** вместе с `.puml`, чтобы диаграммы были видны без локальной генерации.

