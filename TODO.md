- [x] Распознавание лиц из фотобанка с определением персон (кластеризация, справочник персон, Web UI)
- [x] Оптимизация производительности UI: оптимизированы SQL-запросы через кластеры (ускорение в 62 раза), добавлено кэширование API запросов на клиенте, убраны лишние вызовы loadPersonsSubtabs(), добавлен батчинг загрузки персон для карточек. Создан скрипт benchmark_persons_query.py для проверки производительности запросов.
- [ ] Оптимизация параметров кластеризации для уменьшения количества файлов в категории "Посторонние" (сейчас слишком много файлов попадает в эту категорию, возможно нужно понизить eps или использовать другие параметры)
- [ ] Разобраться, что делать с папкой `disk:/Фото/Технологии` (фото по работе): включать ли в правила, отдельная цепочка, или исключить.
- [ ] Добавить поддержку папки Фотокамера как входного источника (копировать новые фото в структуру внутри Фото, не удаляя оригиналы)
- [ ] Реализовать автоматическое обновление access token по refresh token для Яндекс.Диска
- [ ] Автозапуск Web-сервера (uvicorn) на Windows: ярлык/батник и/или Планировщик задач, запуск в фоне.
- [ ] Perceptual hashing для поиска визуально похожих изображений: текущая дедупликация по SHA256 находит только полностью идентичные файлы. Нужна поддержка perceptual hashing (например, pHash, dHash, wHash) для поиска визуально идентичных изображений с разными размерами, сжатием, метаданными (EXIF). Это решит проблему дубликатов, которые не находятся на шаге 1 дедупликации (например, кропы, пересжатые JPEG, файлы с разными метаданными).


## Видео

- [ ] Определить поведение для видео в пайплайне: отдельная папка `_video` vs детект на кадрах (и как это отражать в UI/метриках).
- [ ] Извлечение кадров из видео: стратегия (например 1 кадр/сек или N кадров по длительности), лимиты и таймауты.
- [ ] Детект на кадрах (YuNet/YOLO) и агрегация результата в итоговую категорию для видео (faces/no_faces/animals/quarantine).
- [ ] Превью видео в UI (минимум: thumbnail/первый кадр + длительность).
- [ ] Метрики по видео отдельно (сколько видео, сколько с лицами/котов, “мимо gold” если появится gold для видео).
- [ ] Step0: битые видео отправлять в `_broken_media` и показывать счётчики/примеры причин.

## Ближайшее (после завершения прогона 21)

- [ ] Снять статистику по котам/лицам для `pipeline_run_id=21` (сравнить с 20): /gold → Отчёты → Статистика прогонов, плюс отчёты по `cats_gold`/`faces_gold` при необходимости.

## Видео (MVP: 3 кадра + разметка)

- [ ] Подготовить запуск `run=22` с видео: включение обработки видео (1–3 кадра) в пайплайне и прокидывание параметра из Web UI.
- [ ] /faces: dbl-click по видео → модалка с вкладками **Видео / Кадр 1 / Кадр 2 / Кадр 3** + fullscreen.
- [ ] /faces: разметка лиц для видео — обязательна для всех 3 кадров (сохранение прямоугольников для каждого кадра).
- [ ] /gold: просмотр (без редактирования) видео + 3 кадра, с preview и dbl-click как на /faces.
- [ ] API: выдача JPEG кадра видео по таймкоду (для кадров 1/2/3).
- [ ] DB: хранение разметки видео-кадров (run-scoped) для всех 3 кадров.
- [ ] /gold: кнопки **“Обновить gold из базы”** и **“Заполнить ручную разметку из gold”** — поддержать видео (включая перенос разметки 3 кадров).
