- [x] Распознавание лиц из фотобанка с определением персон (кластеризация, справочник персон, Web UI)
- [x] Оптимизация производительности UI: оптимизированы SQL-запросы через кластеры (ускорение в 62 раза), добавлено кэширование API запросов на клиенте, убраны лишние вызовы loadPersonsSubtabs(), добавлен батчинг загрузки персон для карточек. Создан скрипт benchmark_persons_query.py для проверки производительности запросов.
- [ ] Оптимизация параметров кластеризации для уменьшения количества файлов в категории "Посторонние" (сейчас слишком много файлов попадает в эту категорию, возможно нужно понизить eps или использовать другие параметры)
- [ ] Разобраться, что делать с папкой `disk:/Фото/Технологии` (фото по работе): включать ли в правила, отдельная цепочка, или исключить.
- [ ] Добавить поддержку папки Фотокамера как входного источника (копировать новые фото в структуру внутри Фото, не удаляя оригиналы)
- [ ] Реализовать автоматическое обновление access token по refresh token для Яндекс.Диска
- [ ] Автозапуск Web-сервера (uvicorn) на Windows: ярлык/батник и/или Планировщик задач, запуск в фоне.
- [ ] Perceptual hashing для поиска визуально похожих изображений: текущая дедупликация по SHA256 находит только полностью идентичные файлы. Нужна поддержка perceptual hashing (например, pHash, dHash, wHash) для поиска визуально идентичных изображений с разными размерами, сжатием, метаданными (EXIF). Это решит проблему дубликатов, которые не находятся на шаге 1 дедупликации (например, кропы, пересжатые JPEG, файлы с разными метаданными).


## Видео

Все задачи по видео — в плане: [.cursor/plans/универсальная_карточка_видео.plan.md](.cursor/plans/универсальная_карточка_видео.plan.md)

## Ближайшее (после завершения прогона 21)

- [ ] Снять статистику по котам/лицам для `pipeline_run_id=21` (сравнить с 20): /gold → Отчёты → Статистика прогонов, плюс отчёты по `cats_gold`/`faces_gold` при необходимости.



- [ ]  Разобраться с папкой Фотокамена на ЯД
- [ ]  Сделать карточку поездки
- [x]  Улучшить качество распознавания за счет ручных привязок (embeddings и кластеры при загрузке в архив, backfill, подливка в существующие кластеры)
- [ ]  Очистка БД от удалённых фото: когда и как удалять записи files/photo_rectangles для файлов в _delete или status='deleted' (сейчас остаются в БД, мешают отчётам)
