<!-- Единая карточка видео: просмотр и разметка кадров 1–3 (по аналогии с photo_card) -->
<style>
  .video-card-modal {
    position: fixed;
    inset: 0;
    background: rgba(17,24,39,0.82);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 18px;
    z-index: 9999;
  }
  .video-card-modal[aria-hidden="false"] {
    display: flex;
  }
  .video-card-panel {
    background: #fff;
    border-radius: 14px;
    max-width: 94vw;
    max-height: 94vh;
    width: min(1200px, 94vw);
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    display: flex;
    flex-direction: column;
  }
  .video-card-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 10px 12px;
    border-bottom: 1px solid #e5e7eb;
    min-height: 48px;
  }
  .video-card-top code {
    font-size: 11px;
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .video-card-top .btn {
    appearance: none;
    border: 1px solid #d1d5db;
    background: #fff;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    line-height: 1;
    transition: background 0.15s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 36px;
    height: 28px;
  }
  .video-card-top .btn:hover {
    background: #f9fafb;
    border-color: #9ca3af;
  }
  .video-card-copy-btn {
    padding: 2px 4px !important;
    font-size: 12px !important;
    flex-shrink: 0;
    line-height: 1;
    min-width: 20px !important;
    height: 20px !important;
    visibility: visible !important;
    opacity: 1 !important;
    color: #374151 !important;
    border: none !important;
    background: transparent !important;
  }
  .video-card-copy-btn:hover {
    background: rgba(0,0,0,0.05) !important;
  }
  .video-card-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; flex-shrink: 0; }
  .video-card-tabs {
    display: flex;
    gap: 8px;
    padding: 10px 12px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
    flex-wrap: wrap;
  }
  .video-card-tabs .lb-tab {
    padding: 6px 12px;
    border: 1px solid #d1d5db;
    background: #fff;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: background 0.15s, border-color 0.15s;
  }
  .video-card-tabs .lb-tab:hover {
    background: #f9fafb;
    border-color: #9ca3af;
  }
  .video-card-tabs .lb-tab.active {
    background: #3b82f6;
    border-color: #3b82f6;
    color: #fff;
  }
  .video-card-body {
    background: #111827;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    flex: 1;
    min-height: 0;
    overflow: hidden;
    position: relative;
  }
  .video-card-body .imgwrap {
    position: relative;
    display: inline-block;
  }
  .video-card-body .imgwrap img {
    max-width: 94vw;
    max-height: calc(94vh - 180px);
    min-height: 400px;
    width: auto;
    height: auto;
    display: block;
    object-fit: contain;
    background: #111827;
    user-select: none;
  }
  .video-card-body .imgwrap video {
    max-width: 94vw;
    max-height: calc(94vh - 180px);
    min-height: 400px;
    width: auto;
    height: auto;
    display: block;
    background: #111827;
    user-select: none;
  }
  .video-card-body .imgwrap canvas {
    position: absolute;
    left: 0;
    top: 0;
    pointer-events: none;
    z-index: 10;
  }
  .video-card-body .imgwrap canvas.draw-on {
    pointer-events: auto;
    cursor: crosshair;
  }
  .video-card-keyframe-row .btn-keyframe {
    background: #3b82f6;
    border-color: #3b82f6;
    color: #fff;
    font-size: 12px;
    padding: 6px 10px;
  }
  .video-card-keyframe-row .btn-keyframe:hover {
    background: #2563eb;
    border-color: #2563eb;
  }
  .video-card-frame-actions {
    padding: 8px 12px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
  }
  .video-card-frame-actions .video-card-keyframe-row,
  .video-card-frame-actions .video-card-annotate-row {
    display: inline-flex;
    gap: 8px;
    align-items: center;
  }
  .video-card-navigation {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 10px 12px;
    border-top: 1px solid #e5e7eb;
    background: #f9fafb;
    position: relative;
  }
  .video-card-position {
    font-weight: 700;
    font-size: 14px;
  }
  .video-card-bottom {
    padding: 10px 12px;
    border-top: 1px solid #e5e7eb;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  .video-card-bottom .rectlist {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .video-card-bottom .rectpill {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    background: #eef2ff;
    color: #1f2937;
    font-size: 12px;
    border: 1px solid #c7d2fe;
    cursor: pointer;
  }
  .video-card-bottom .rectpill:hover {
    background: #c7d2fe;
  }
  .video-card-bottom .rectpill .rectpill-frame {
    display: inline-block;
    margin-right: 4px;
    padding: 0 4px;
    border-radius: 4px;
    background: rgba(59, 130, 246, 0.2);
    color: #2563eb;
    font-size: 10px;
    font-weight: 600;
  }
  .video-card-bottom .muted { color: #6b7280; }
  .video-card-rectlist-header { display: flex; align-items: center; gap: 8px; }
  .video-card-bottom .btn.btn-small { padding: 2px 8px; font-size: 11px; min-height: 22px; height: 22px; line-height: 1; }
  .video-card-bottom .btn.danger { color: #dc2626; border-color: #fca5a5; }
  .video-card-bottom .btn.danger:hover { background: #fee2e2; border-color: #dc2626; }
  .video-card-person-modal {
    position: fixed;
    inset: 0;
    background: rgba(17,24,39,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10001;
  }
  .video-card-person-modal[aria-hidden="false"] { display: flex; }
  .video-card-person-panel {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    min-width: 280px;
  }
  .video-card-person-title { margin: 0 0 12px 0; font-weight: 700; font-size: 14px; }
  .video-card-person-select {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 14px;
    margin-bottom: 12px;
  }
  .video-card-person-actions { display: flex; gap: 8px; justify-content: flex-end; }
  /* Меню привязки (как в photo_card) */
  .video-card .assign-person-menu {
    position: absolute;
    left: 0;
    bottom: 100%;
    margin-bottom: 4px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 200px;
    z-index: 10001;
    padding: 4px 0;
  }
  .video-card .assign-person-menu button {
    width: 100%;
    padding: 10px 12px;
    text-align: left;
    border: none;
    background: #fff;
    cursor: pointer;
    font-size: 14px;
  }
  .video-card .assign-person-menu button:hover {
    background: #f9fafb;
  }
  .video-card .assign-person-menu button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }
  .video-card .area-submenu {
    position: absolute;
    left: 100%;
    top: 0;
    margin-left: 4px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 150px;
    z-index: 10002;
    padding: 4px 0;
  }
  /* Меню pill и прямоугольника (как в photo_card) */
  .video-card .rectpill-actions-menu {
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 4px;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 180px;
    z-index: 10000;
    padding: 4px 0;
    display: none;
  }
  .video-card .rectpill-actions-menu.open { display: block; }
  .video-card .rectpill-actions-menu.rectpill-actions-menu-right {
    bottom: auto;
    right: auto;
    left: 100%;
    top: 0;
    margin-bottom: 0;
    margin-left: 4px;
  }
  .video-card .rectpill-actions-menu.rectpill-actions-menu-left {
    bottom: auto;
    left: auto;
    right: 100%;
    top: 0;
    margin-bottom: 0;
    margin-left: 0;
    margin-right: 4px;
  }
  /* Меню над pill: выравнивание по левому краю pill, если иначе уходит за экран влево */
  .video-card .rectpill-actions-menu.rectpill-actions-menu-above-left {
    right: auto;
    left: 0;
  }
  .video-card .rectpill-actions-menu button {
    display: block;
    width: 100%;
    padding: 10px 14px;
    text-align: left;
    background: none;
    border: none;
    border-bottom: 1px solid #f3f4f6;
    color: #111827;
    cursor: pointer;
    font-size: 13px;
  }
  .video-card .rectpill-actions-menu button:last-child { border-bottom: none; }
  .video-card .rectpill-actions-menu button:hover { background: #f9fafb; }
  .video-card .rectpill-actions-menu button.danger { color: #dc2626; }
  .video-card .rectpill-actions-menu button.danger:hover { background: #fee2e2; }
  .video-card .rectpill-action {
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px 6px;
    font-size: 16px;
    color: #6b7280;
  }
  .video-card .rectpill { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; position: relative; }
  .video-card .video-rect-menu {
    position: absolute;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 180px;
    z-index: 10001;
    padding: 4px 0;
  }
  .video-card .video-rect-menu button {
    display: block;
    width: 100%;
    padding: 10px 14px;
    text-align: left;
    background: none;
    border: none;
    border-bottom: 1px solid #f3f4f6;
    color: #111827;
    cursor: pointer;
    font-size: 13px;
  }
  .video-card .video-rect-menu button:last-child { border-bottom: none; }
  .video-card .video-rect-menu button:hover { background: #f9fafb; }
  .video-card .person-submenu .menu-group-label {
    padding: 6px 14px 4px;
    font-size: 11px;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .video-card .video-rect-menu button.danger { color: #dc2626; }
</style>

<div class="video-card-modal video-card" id="videoCardModal" aria-hidden="true" style="display: none;">
  <div class="video-card-panel" role="dialog" aria-modal="true">
    <!-- Заголовок (как в photo_card) -->
    <div class="video-card-top">
      <div style="display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0;">
        <code class="video-card-path" id="videoCardPath" style="flex: 0 1 auto; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">—</code>
        <button class="btn video-card-copy-btn" id="videoCardCopyPath" type="button" title="Скопировать путь в буфер обмена">
          <span role="img" style="display: inline-flex; align-items: center; justify-content: center;">
            <svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" viewBox="0 0 1024 1024" style="display: block !important; width: 14px !important; height: 14px !important;">
              <path d="M464 85.333333H768q70.698667 0 120.661333 50.005334Q938.666667 185.301333 938.666667 256v304a42.666667 42.666667 0 1 1-85.333334 0V256q0-35.328-25.002666-60.330667T768 170.666667h-304a42.666667 42.666667 0 1 1 0-85.333334z m314.666667 714.666667q0 57.429333-40.618667 98.048T640 938.666667H224q-57.429333 0-98.048-40.618667T85.333333 800V384q0-57.429333 40.618667-98.048T224 245.333333H640q57.429333 0 98.048 40.618667T778.666667 384v416z m-85.333334 0V384q0-22.101333-15.616-37.717333T640 330.666667H224q-22.101333 0-37.717333 15.616T170.666667 384v416q0 22.101333 15.616 37.717333T224 853.333333H640q22.101333 0 37.717333-15.616t15.616-37.717333z"></path>
            </svg>
          </span>
        </button>
      </div>
      <div class="video-card-actions">
        <button class="btn" id="videoCardToggleRectangles" type="button">Скрыть прямоугольники</button>
        <button class="btn" id="videoCardUndo" type="button" title="Отменить последнее действие" disabled>Undo</button>
        <button class="btn" id="videoCardClose" type="button">Закрыть</button>
      </div>
    </div>

    <!-- Вкладки: Видео / Кадр 1 / Кадр 2 / Кадр 3 -->
    <div class="video-card-tabs">
      <button class="lb-tab" id="videoCardTabVideo" type="button">Видео</button>
      <button class="lb-tab" id="videoCardTabF1" type="button">Кадр 1</button>
      <button class="lb-tab" id="videoCardTabF2" type="button">Кадр 2</button>
      <button class="lb-tab" id="videoCardTabF3" type="button">Кадр 3</button>
    </div>

    <!-- Кнопки: для Видео — «На Кадр 1/2/3» -->
    <div class="video-card-frame-actions" id="videoCardFrameActions">
      <div class="video-card-keyframe-row" id="videoCardKeyframeRow">
        <span class="muted">Позиция при паузе:</span>
        <button class="btn btn-keyframe" id="videoCardSetFrame1" type="button">На Кадр 1</button>
        <button class="btn btn-keyframe" id="videoCardSetFrame2" type="button">На Кадр 2</button>
        <button class="btn btn-keyframe" id="videoCardSetFrame3" type="button">На Кадр 3</button>
      </div>
    </div>

    <!-- Область контента -->
    <div class="video-card-body">
      <div class="imgwrap" id="videoCardImgWrap">
        <img id="videoCardImg" alt="кадр видео" style="display:none;" referrerPolicy="no-referrer" />
        <video id="videoCardVideo" controls preload="metadata" style="display:none;"></video>
        <canvas id="videoCardCanvas"></canvas>
      </div>
    </div>

    <!-- Навигация (как в photo_card) -->
    <div class="video-card-navigation">
      <div style="position: absolute; left: 12px; display: flex; gap: 8px; align-items: center;" id="videoCardAssignPersonContainer">
        <button class="btn" id="videoCardAssignPerson" type="button">Привязать персону ▶</button>
        <button class="btn danger" id="videoCardDelete" type="button" title="Удалить файл (в _delete)">Удалить</button>
        <button class="btn" id="videoCardMarkAsCat" type="button" title="Пометить файл как «кот» (удаляет прямоугольники, переводит в Животные)">Кот</button>
      </div>
      <div style="display: flex; align-items: center; gap: 12px;">
        <button class="btn" id="videoCardPrev" type="button" style="display:none;">←</button>
        <span class="video-card-position" id="videoCardPosition">—</span>
        <button class="btn" id="videoCardNext" type="button" style="display:none;">→</button>
      </div>
      <div id="videoCardSpecialActions" style="position: absolute; right: 12px; display: flex; gap: 8px; align-items: center;">
        <button class="btn" id="videoCardAssignOutsider" type="button">Все остальные — посторонние</button>
        <select id="videoCardGroupSelect" style="min-width:160px; border:1px solid #d1d5db; border-radius:6px; padding:6px 10px; font-size:13px;">
          <option value="">Назначить группу...</option>
        </select>
      </div>
    </div>

    <!-- Привязки и прямоугольники (как в photo_card) -->
    <div class="video-card-bottom">
      <div class="video-card-rectlist-header">
        <span class="muted" id="videoCardRectListLabel">Привязки:</span>
        <button class="btn btn-small danger" id="videoCardDeleteAllRects" type="button" title="Удалить все прямоугольники на всех кадрах">Удалить все</button>
      </div>
      <div class="rectlist" id="videoCardRectList"></div>
    </div>
  </div>
</div>

<!-- Модальное окно выбора персоны для прямоугольника -->
<div class="video-card-person-modal" id="videoCardPersonModal" aria-hidden="true" style="display:none;">
  <div class="video-card-person-panel">
    <p class="video-card-person-title">Назначить персону</p>
    <select id="videoCardPersonSelect" class="video-card-person-select">
      <option value="">— Выберите персону —</option>
    </select>
    <div class="video-card-person-actions">
      <button class="btn" id="videoCardPersonOk" type="button">OK</button>
      <button class="btn" id="videoCardPersonClear" type="button">Снять</button>
      <button class="btn" id="videoCardPersonCancel" type="button">Отмена</button>
    </div>
  </div>
</div>
