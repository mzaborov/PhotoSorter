---
name: ""
overview: ""
todos: []
isProject: false
---

# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω—ã (–±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏)

## –¶–µ–ª—å

–£–ª—É—á—à–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø–æ–¥—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–µ—Ä—Å–æ–Ω–∞—Ö —Å —É—á–µ—Ç–æ–º 3 —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏ (–∫–ª–∞—Å—Ç–µ—Ä—ã, —Ä—É—á–Ω—ã–µ rectangles, –ø—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞) –∏ 2 —Ç–∏–ø–æ–≤ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Ñ–æ—Ç–æ–∞—Ä—Ö–∏–≤, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è). –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ `file_path`, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è `archive_scope`.

## –ü—Ä–∏–Ω—Ü–∏–ø –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω

**–ë–ï–ó –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `archive_scope` –≤ —Ç–∞–±–ª–∏—Ü—ã `person_rectangles` –∏ `file_persons`!**

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `file_path`:

- **–ê—Ä—Ö–∏–≤**: `file_path` –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `disk:/–§–æ—Ç–æ` (–∏–ª–∏ –¥—Ä—É–≥–∏–µ –∫–æ—Ä–Ω–∏ –∞—Ä—Ö–∏–≤–∞ –∏–∑ env)
- **–ü—Ä–æ–≥–æ–Ω**: `file_path` –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `disk:/–§–æ—Ç–æ` –ò –µ—Å—Ç—å `pipeline_run_id`

–î–ª—è `photo_rectangles` (–±—ã–≤—à–∞—è `face_rectangles`) –∏ `face_clusters` `archive_scope` —É–∂–µ –µ—Å—Ç—å (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç.–∫. —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –ª–∏—Ü–∞—Ö/–∫–ª–∞—Å—Ç–µ—Ä–∞—Ö). **–í–ê–ñ–ù–û:** –í–æ –≤—Å–µ—Ö SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Ü–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä `is_face=1`, —Ç–∞–∫ –∫–∞–∫ `photo_rectangles` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∏ –ª–∏—Ü–∞ (is_face=1), –∏ –ø–µ—Ä—Å–æ–Ω—ã (is_face=0).

## –ó–∞–¥–∞—á–∞ A: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω

### A1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏

**–§–∞–π–ª:** `backend/web_api/templates/persons_list.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –ó–∞–º–µ–Ω–∏—Ç—å "–ê—Ä—Ö–∏–≤ / –ü—Ä–æ–≥–æ–Ω" –Ω–∞ "–§–æ—Ç–æ–∞—Ä—Ö–∏–≤ / –°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è" –≤–æ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
2. –°–¥–µ–ª–∞—Ç—å –≤—Å–µ —á–∏—Å–ª–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–µ—Ä—Å–æ–Ω—ã:

   - **–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞ (–§–æ—Ç–æ–∞—Ä—Ö–∏–≤ / –°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)**: —Å—Å—ã–ª–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ `/persons/{person_id}#faces-archive` –∏–ª–∏ `/persons/{person_id}#faces-run` —Å –æ—Ç–∫—Ä—ã—Ç–æ–π –≤–∫–ª–∞–¥–∫–æ–π "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞"
   - **–ß–µ—Ä–µ–∑ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏**: —Å—Å—ã–ª–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ `/persons/{person_id}#rectangles-archive` –∏–ª–∏ `/persons/{person_id}#rectangles-run`
   - **–ü—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞**: —Å—Å—ã–ª–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ `/persons/{person_id}#direct-archive` –∏–ª–∏ `/persons/{person_id}#direct-run`

3. –§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–æ–∫: `–§–æ—Ç–æ–∞—Ä—Ö–∏–≤ / –°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è` –≥–¥–µ –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ - –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞

### A2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å—á–µ—Ç–æ–≤ –≤ API

**–§–∞–π–ª:** `backend/web_api/routers/face_clusters.py` (—Ñ—É–Ω–∫—Ü–∏—è `api_persons_stats`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å `archive_scope` –≤ —Ç–∞–±–ª–∏—Ü—ã!** –û–ø—Ä–µ–¥–µ–ª—è—Ç—å –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ `file_path`:

   - –§—É–Ω–∫—Ü–∏—è-—Ö–µ–ª–ø–µ—Ä: `_is_archive_path(file_path: str) -> bool` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –ø—É—Ç—å —Å `disk:/–§–æ—Ç–æ`

2. –û–±–Ω–æ–≤–∏—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è `person_rectangles`:
   ```sql
   SELECT 
       pr.person_id,
       COUNT(DISTINCT CASE WHEN pr.file_path LIKE 'disk:/–§–æ—Ç–æ%' THEN pr.file_path END) as files_archive,
       COUNT(DISTINCT CASE WHEN pr.file_path NOT LIKE 'disk:/–§–æ—Ç–æ%' AND pr.pipeline_run_id IS NOT NULL THEN pr.file_path END) as files_run,
       COUNT(DISTINCT pr.file_path) as files_total
   FROM person_rectangles pr
   GROUP BY pr.person_id
   ```

3. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è `file_persons`
4. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞" –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω (—É–∂–µ –µ—Å—Ç—å —á–µ—Ä–µ–∑ `photo_rectangles.archive_scope`). **–í–ê–ñ–ù–û:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∏—Ü–∞ —á–µ—Ä–µ–∑ `photo_rectangles.is_face = 1`.

### A3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–µ

**–§–∞–π–ª:** `backend/web_api/templates/persons_list.html`

- –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `renderPersonRow` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–∫–æ–≤ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É

## –ó–∞–¥–∞—á–∞ B: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω—ã

### B1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏ –≤ API

**–§–∞–π–ª:** `backend/web_api/routers/face_clusters.py` (—Ñ—É–Ω–∫—Ü–∏—è `api_person_detail`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –†–∞—Å—à–∏—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö 3 —Ç–∏–ø–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏:

   - –ß–µ—Ä–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä—ã (—É–∂–µ –µ—Å—Ç—å, —á–µ—Ä–µ–∑ `photo_rectangles.archive_scope`, —Ñ–∏–ª—å—Ç—Ä `is_face=1`)
   - –ß–µ—Ä–µ–∑ —Ä—É—á–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏ (`person_rectangle_manual_assignments` - —á–µ—Ä–µ–∑ `photo_rectangles.archive_scope`, —Ñ–∏–ª—å—Ç—Ä `is_face=1`)
   - –ß–µ—Ä–µ–∑ `person_rectangles` - **–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∞—Ä—Ö–∏–≤ —á–µ—Ä–µ–∑ `file_path LIKE 'disk:/–§–æ—Ç–æ%'`**
   - –ß–µ—Ä–µ–∑ `file_persons` - **–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∞—Ä—Ö–∏–≤ —á–µ—Ä–µ–∑ `file_path LIKE 'disk:/–§–æ—Ç–æ%'`**

2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ç–∏–ø–µ –ø—Ä–∏–≤—è–∑–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:

   - `assignment_type`: `'cluster'`, `'manual_face'`, `'person_rectangle'`, `'file_person'`
   - `source`: `'archive'` –∏–ª–∏ `'run'` (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `file_path` –∏–ª–∏ `archive_scope` –¥–ª—è –ª–∏—Ü)

3. –î–ª—è –ø—Ä—è–º–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ (`file_persons`) –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ —Ü–µ–ª–∏–∫–æ–º (–±–µ–∑ –∫—Ä–æ–ø–∞)
4. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –§–æ—Ç–æ–∞—Ä—Ö–∏–≤/–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤

### B2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

**–ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å `archive_scope` –≤ `person_rectangles` –∏ `file_persons`!**

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `file_path` –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö.

### B3. –û–±—â–∏–π —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**–§–∞–π–ª:** `backend/web_api/templates/person_detail.html`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è "–û–±—â–∏–π / –î–µ—Ç–∞–ª—å–Ω—ã–π"
- –í –æ–±—â–µ–º —Ä–µ–∂–∏–º–µ:
  - –ï–¥–∏–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:
    - –ö—Ä–æ–ø—ã rectangles (–∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ + —Ä—É—á–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏)
    - –§–æ—Ç–æ —Ü–µ–ª–∏–∫–æ–º –¥–ª—è –ø—Ä—è–º–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ (`file_persons`)
  - –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (–∏–∫–æ–Ω–∫–∏/–ø–æ–¥–ø–∏—Å–∏)
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –§–æ—Ç–æ–∞—Ä—Ö–∏–≤/–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è (—Å–µ–∫—Ü–∏–∏ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã)

### B4. –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**–§–∞–π–ª:** `backend/web_api/templates/person_detail.html`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

- 2 –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏: "–§–æ—Ç–æ–∞—Ä—Ö–∏–≤" / "–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è"
- –í –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ 3 –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏:

  1. **–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞** ‚Äî –ª–∏—Ü–∞ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ + –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–∫–∞–∫ –≤ `person_clusters.html`)
  2. **–ß–µ—Ä–µ–∑ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏** ‚Äî —Ä—É—á–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏ (`person_rectangle_manual_assignments` + `person_rectangles`, —Ç–æ–ª—å–∫–æ –ª–∏—Ü–∞ —Å `is_face=1`)
  3. **–ü—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞** ‚Äî —Ñ–∞–π–ª—ã —Ü–µ–ª–∏–∫–æ–º (`file_persons`)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –í –ø–æ–¥–≤–∫–ª–∞–¥–∫–µ "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞" –≤—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–∫–∞—Ä—Ç–æ—á–∫–∏ –∫–∞–∫ –≤ `person_clusters.html`)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (lightbox, –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∫–æ—Ä–µ–π –≤ URL –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É (`#faces-archive`, `#rectangles-run` –∏ —Ç.–¥.)

### B4.1 –ö–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ (–∞—Ä—Ö–∏–≤ vs —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)

**–§–∞–π–ª—ã:** `backend/web_api/static/photo_card.js`, `backend/web_api/templates/photo_card.html`

–ö–∞—Ä—Ç–æ—á–∫–∞ —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω–∞ —Ä–∞–∑–ª–∏—á–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç **–§–æ—Ç–æ–∞—Ä—Ö–∏–≤** –∏ **–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è** (—á–µ—Ä–µ–∑ `list_context` / scope –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏) –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ –Ω–∞ –ø–ª–∞—à–∫–∞—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ (–ª–∏—Ü).

**–§–æ—Ç–æ–∞—Ä—Ö–∏–≤:**

- **–ê–≤–∞—Ç–∞—Ä** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ –∞—Ä—Ö–∏–≤–∞. –ö–Ω–æ–ø–∫–∞ ¬´–ê–≤–∞—Ç–∞—Ä¬ª –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –§–æ—Ç–æ–∞—Ä—Ö–∏–≤.
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–ù–µ –ª–∏—Ü–æ, –î—Ä—É–≥–æ–π –∏ —Ç.–¥.) ‚Äî –ø–æ —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–µ.

**–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è:**

- **–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π** ‚Äî –Ω–∞–∑–Ω–∞—á–∏—Ç—å rectangle –ø–µ—Ä—Å–æ–Ω–µ ¬´–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π¬ª (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API / –¥–µ–π—Å—Ç–≤–∏–µ).
- **–ö–æ—Ç** ‚Äî –ø–æ–º–µ—Ç–∏—Ç—å —Ñ–∞–π–ª –∫–∞–∫ ¬´–∫–æ—Ç¬ª (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ).
- **–ù–µ –ª–∏—Ü–æ** ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ ¬´—É–±–∏—Ç—å¬ª rectangle: —É–¥–∞–ª–∏—Ç—å/–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å rectangle (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `ignore_flag` –∏ —Ç.–ø.).
- **–î—Ä—É–≥–æ–π** ‚Äî –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω; –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–µ—Ä—Å–æ–Ω—ã ‚Äî –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å rectangle –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–µ—Ä—Å–æ–Ω—É.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

- –£—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∞—Ä—Ö–∏–≤ / —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è).
- –î–ª—è ¬´–î—Ä—É–≥–æ–π¬ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—ã–ø–∞–¥–∞—à–∫—É —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–µ—Ä—Å–æ–Ω (`/api/persons/list` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥).

### B5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JavaScript –ª–æ–≥–∏–∫–∏

**–§–∞–π–ª:** `backend/web_api/templates/person_detail.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä—è–º–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ (—Ñ–æ—Ç–æ —Ü–µ–ª–∏–∫–æ–º –±–µ–∑ –∫—Ä–æ–ø–∞)
4. –û–±–Ω–æ–≤–∏—Ç—å lightbox –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
5. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —è–∫–æ—Ä–µ–π URL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –Ω—É–∂–Ω–æ–π –∑–∞–∫–ª–∞–¥–∫–∏
6. –í—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ –ø–æ–¥–≤–∫–ª–∞–¥–∫—É "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞"

## –ó–∞–¥–∞—á–∞ C: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

### C1. –ü–æ–∫–∞–∑ —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

**–§–∞–π–ª:** `backend/web_api/templates/face_clusters.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –û–±–Ω–æ–≤–∏—Ç—å API –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–Ω—ã—Ö)
2. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä/–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–∫–∞–∑–∞:

   - –¢–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–Ω—ã–µ (—Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
   - –¢–æ–ª—å–∫–æ —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ
   - –í—Å–µ (–∞—Ä—Ö–∏–≤–Ω—ã–µ + —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ)

3. –í–∏–∑—É–∞–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ã –ø–æ —Ç–∏–ø—É (–∏–∫–æ–Ω–∫–∞/–ø–æ–¥–ø–∏—Å—å)

### C2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –¥–ª—è –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

**–§–∞–π–ª:** `backend/web_api/routers/face_clusters.py` (—Ñ—É–Ω–∫—Ü–∏—è `api_face_clusters_list`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã (–∞—Ä—Ö–∏–≤–Ω—ã–µ + —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ)
2. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä `show_archive_only` / `show_run_only`
3. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω (—á–µ—Ä–µ–∑ `face_clusters.archive_scope`)

## –ó–∞–¥–∞—á–∞ D: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ —Å–ø–∏—Å–∫–∞ –ª–∏—Ü –ø–µ—Ä—Å–æ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–æ–∫ –ª–∏—Ü –ø–µ—Ä—Å–æ–Ω—ã 4) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `list_context` —Å –º–∞—Å—Å–∏–≤–æ–º `items`. –ï—Å–ª–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É –ª–∏—Ü–∞ –∫ –¥—Ä—É–≥–æ–π –ø–µ—Ä—Å–æ–Ω–µ, –∏—Å—Ö–æ–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä—Å–æ–Ω—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

- –í –∫–∞—Ä—Ç–æ—á–∫–µ —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç —É–∂–µ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–µ
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–º (–Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1 –ø—É–Ω–∫—Ç)

### –†–µ—à–µ–Ω–∏–µ

**–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π). –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `file_id` + `rectangle_id` –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞.

### D1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏

**–§–∞–π–ª:** `backend/web_api/static/photo_card.js` (—Ñ—É–Ω–∫—Ü–∏—è `closePhotoCard()`)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å `list_context` —Å `source_page === "person_detail"`, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å CustomEvent:
   ```javascript
   if (currentState.list_context?.source_page === 'person_detail') {
     // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π rectangle –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
     const currentItem = currentState.list_context.items[currentState.list_context.current_index];
     const currentRectangleId = currentItem?.face_rectangle_id || currentItem?.person_rectangle_id || null;
     
     const event = new CustomEvent('photoCardClosed', {
       detail: {
         source_page: 'person_detail',
         file_id: currentState.file_id,
         file_path: currentState.file_path,
         face_rectangle_id: currentItem?.face_rectangle_id || null,
         person_rectangle_id: currentItem?.person_rectangle_id || null,
         rectangle_id: currentRectangleId // –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ - –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤—ã—à–µ
       }
     });
     window.dispatchEvent(event);
   }
   ```

2. **–í–∞–∂–Ω–æ**: –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π), —á—Ç–æ–±—ã —Å–ø–∏—Å–æ–∫ –≤—Å–µ–≥–¥–∞ –±—ã–ª –∞–∫—Ç—É–∞–ª—å–Ω—ã–º.

### D2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä—Å–æ–Ω—ã

**–§–∞–π–ª:** `backend/web_api/templates/person_detail.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏—è `photoCardClosed`:
   ```javascript
   window.addEventListener('photoCardClosed', async function(event) {
     if (event.detail.source_page === 'person_detail') {
       console.log('–ö–∞—Ä—Ç–æ—á–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞–∫—Ä—ã—Ç–∞, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω—ã');
       
       // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
       const focusData = {
         file_id: event.detail.file_id,
         file_path: event.detail.file_path,
         face_rectangle_id: event.detail.face_rectangle_id,
         person_rectangle_id: event.detail.person_rectangle_id,
         rectangle_id: event.detail.rectangle_id
       };
       
       // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
       await loadPerson();
       
       // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
       focusOnRectangle(focusData);
     }
   });
   ```

2. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `focusOnRectangle()` –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
   ```javascript
   function focusOnRectangle(focusData) {
     if (!focusData) return;
     
     // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ –ø–æ file_id + rectangle_id
     const { file_id, file_path, face_rectangle_id, person_rectangle_id } = focusData;
     
     // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–µ—Ç–∫–µ –ª–∏—Ü
     const thumbElements = document.querySelectorAll('.thumb[data-face-id], .thumb[data-file-path]');
     
     for (const thumb of thumbElements) {
       const thumbFileId = thumb.getAttribute('data-file-id');
       const thumbFilePath = thumb.getAttribute('data-file-path');
       const thumbFaceId = thumb.getAttribute('data-face-id');
       const thumbPersonRectId = thumb.getAttribute('data-person-rectangle-id');
       
       // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ file_id –∏–ª–∏ file_path
       const fileMatches = (file_id && thumbFileId && parseInt(thumbFileId) === file_id) ||
                          (file_path && thumbFilePath === file_path);
       
       if (fileMatches) {
         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ rectangle_id
         const rectMatches = (face_rectangle_id && thumbFaceId && parseInt(thumbFaceId) === face_rectangle_id) ||
                            (person_rectangle_id && thumbPersonRectId && parseInt(thumbPersonRectId) === person_rectangle_id);
         
         if (rectMatches || (!face_rectangle_id && !person_rectangle_id)) {
           // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É –∏ –≤—ã–¥–µ–ª—è–µ–º –µ–≥–æ
           thumb.scrollIntoView({ behavior: 'smooth', block: 'center' });
           thumb.focus(); // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—ã–π
           
           // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
           thumb.style.outline = '3px solid #0b57d0';
           setTimeout(() => {
             thumb.style.outline = '';
           }, 2000);
           
           return; // –ù–∞–π–¥–µ–Ω –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω
         }
       }
     }
     
     console.warn('–≠–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω:', focusData);
   }
   ```

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç** (–µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –∏–º–µ—é—Ç data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤):

   - –ü–æ—Å–ª–µ `loadPerson()` –∏—Å–∫–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤ `personData.faces` –ø–æ `file_id` + `face_rectangle_id`
   - –í—ã—á–∏—Å–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Å–µ—Ç–∫–µ
   - –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å –∫ –Ω—É–∂–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

### D3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤ –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª:** `backend/web_api/templates/person_detail.html` (—Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ª–∏—Ü)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–µ—Ç–∫–∏ –ª–∏—Ü –¥–æ–±–∞–≤–ª—è—Ç—å data-–∞—Ç—Ä–∏–±—É—Ç—ã:
   ```javascript
   const thumb = document.createElement('div');
   thumb.className = 'thumb';
   thumb.setAttribute('data-file-id', face.file_id || '');
   thumb.setAttribute('data-file-path', face.file_path || '');
   thumb.setAttribute('data-face-id', face.face_id || ''); // face_rectangle_id
   thumb.setAttribute('data-person-rectangle-id', face.person_rectangle_id || '');
   // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
   ```

2. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Ç–æ—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞.

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –∑–∞–¥–∞—á–µ D

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ—à–µ–Ω–∏—è**: –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–¢–æ—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ–º `file_id` + `rectangle_id` –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞, —á—Ç–æ –Ω–∞–¥–µ–∂–Ω–µ–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–µ—à–µ–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (faces.html, face_cluster_detail.html), —Ç–æ–ª—å–∫–æ –Ω–∞ person_detail.html
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ú–µ—Ö–∞–Ω–∏–∑–º –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **API –¥–ª—è —Å–ø–∏—Å–∫–∞** (A2) ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç—ã —á–µ—Ä–µ–∑ `file_path`, –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
2. **UI —Å–ø–∏—Å–∫–∞** (A1, A3) ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å, –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
3. **API –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏** (B1) ‚Äî —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ `file_path`
4. **UI –∫–∞—Ä—Ç–æ—á–∫–∏** (B3, B4, B5) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –≤–∫–ª–∞–¥–∫–∏, —Ç–∞–±–ª–∏—Ü—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
5. **–ö–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ** (B4.1) ‚Äî –ê–≤–∞—Ç–∞—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—Ä—Ö–∏–≤–∞; –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π, –ö–æ—Ç, –ù–µ –ª–∏—Ü–æ, –î—Ä—É–≥–æ–π (–≤—ã–ø–∞–¥–∞—à–∫–∞)
6. **–§–æ—Ä–º–∞ –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö** (C1, C2) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∫–∞–∑ —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
7. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞** (D1-D3) ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ file_id + rectangle_id

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

- `backend/web_api/routers/face_clusters.py` ‚Äî API (`api_persons_stats`, `api_person_detail`, `api_face_clusters_list`)
- `backend/web_api/templates/persons_list.html` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω
- `backend/web_api/templates/person_detail.html` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä—Å–æ–Ω—ã
- `backend/web_api/templates/face_clusters.html` ‚Äî –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
- `backend/web_api/static/photo_card.js` ‚Äî –∫–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (B4.1), –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (D)
- `backend/web_api/templates/photo_card.html` ‚Äî —Ä–∞–∑–º–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (B4.1)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–í–ê–ñ–ù–û**: –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å `archive_scope` –≤ `person_rectangles` –∏ `file_persons`!
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —á–µ—Ä–µ–∑ `file_path LIKE 'disk:/–§–æ—Ç–æ%'` –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö
- –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –∞—Ä—Ö–∏–≤–∞/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞–¥–∞–Ω–∞ –≤ **B4.1** (–ê–≤–∞—Ç–∞—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—Ä—Ö–∏–≤–∞; –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π, –ö–æ—Ç, –ù–µ –ª–∏—Ü–æ, –î—Ä—É–≥–æ–π-–≤—ã–ø–∞–¥–∞—à–∫–∞)
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- –Ø–∫–æ—Ä—è URL –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ (–∑–∞–¥–∞—á–∞ D)**: –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞ –ª–∏—Ü –ø–µ—Ä—Å–æ–Ω—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä—Å–æ–Ω—ã (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π). –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `file_id` + `rectangle_id` –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞, —á—Ç–æ –Ω–∞–¥–µ–∂–Ω–µ–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º CustomEvent –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 2026-01-23

- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü –∑–∞–≤–µ—Ä—à–µ–Ω–∞**: `face_rectangles` ‚Üí `photo_rectangles`, `face_person_manual_assignments` ‚Üí `person_rectangle_manual_assignments`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `is_face`**: 1=–ª–∏—Ü–æ, 0=–ø–µ—Ä—Å–æ–Ω–∞. –í–æ –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Ü–∞–º–∏ –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä `is_face=1`
- ‚úÖ **–†–∞–∑–±–∏–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏–≤—è–∑–æ–∫ –ª–∏—Ü**: –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/persons` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞" —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä—ã –∏ —Ä—É—á–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏, –∫–∞–∂–¥–∞—è —Å –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω—ã**: –í `photo_card.js` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `rectangle_id` –≤ —á–∏—Å–ª–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### 2026-01-24 (–ê–ì–ï–ù–¢ 3)

- ‚úÖ **–≠–¢–ê–ü 3.1 (–ó–∞–¥–∞—á–∞ A2)**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω API `api_persons_stats` - –¥–æ–±–∞–≤–ª–µ–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω –¥–ª—è `person_rectangles` –∏ `file_persons` —á–µ—Ä–µ–∑ JOIN —Å `files` –ø–æ `file_id`
- ‚úÖ **–≠–¢–ê–ü 3.2 (–ó–∞–¥–∞—á–∞ A1, A3)**: –û–±–Ω–æ–≤–ª–µ–Ω UI —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω - –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —ç—Ç–∞–ø–∞ 2:
  - –ö–ª–∞—Å—Ç–µ—Ä—ã: –æ–¥–Ω–æ —á–∏—Å–ª–æ (–±–µ–∑ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω)
  - –ß–µ—Ä–µ–∑ –ª–∏—Ü–∞: –æ–±—â–µ–µ —á–∏—Å–ª–æ + –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å 4 —Ä–∞–∑—Ä–µ–∑–∞–º–∏ (–ê—Ä—Ö–∏–≤/–ü—Ä–æ–≥–æ–Ω √ó –ö–ª–∞—Å—Ç–µ—Ä—ã/–†—É—á–Ω—ã–µ)
  - –ß–µ—Ä–µ–∑ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏: –æ–¥–Ω–æ —á–∏—Å–ª–æ
  - –ü—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞: –æ–¥–Ω–æ —á–∏—Å–ª–æ
- ‚úÖ **–≠–¢–ê–ü 3.3 (–ó–∞–¥–∞—á–∞ B1)**: –†–∞—Å—à–∏—Ä–µ–Ω API `api_person_detail` –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏:
  - –ß–µ—Ä–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä—ã (`assignment_type: 'cluster'`)
  - –ß–µ—Ä–µ–∑ —Ä—É—á–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏ (`assignment_type: 'manual_face'`)
  - –ß–µ—Ä–µ–∑ `person_rectangles` (`assignment_type: 'person_rectangle'`)
  - –ß–µ—Ä–µ–∑ `file_persons` (`assignment_type: 'file_person'`)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ `source` (archive/run) –∏ `assignment_type` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞/–ø—Ä–æ–≥–æ–Ω–∞ —á–µ—Ä–µ–∑ `file_path LIKE 'disk:/–§–æ—Ç–æ%'` –¥–ª—è `person_rectangles` –∏ `file_persons`
- ‚úÖ **–≠–¢–ê–ü 3.4 (–ó–∞–¥–∞—á–∞ B3, B4, B5)**: –û–±–Ω–æ–≤–ª–µ–Ω UI –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω—ã:
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–∂–∏–º—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: "–û–±—â–∏–π" / "–î–µ—Ç–∞–ª—å–Ω—ã–π"
  - –í –¥–µ—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ: –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ "–§–æ—Ç–æ–∞—Ä—Ö–∏–≤" / "–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è"
  - –í –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ: –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ "–ß–µ—Ä–µ–∑ –ª–∏—Ü–∞", "–ß–µ—Ä–µ–∑ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏", "–ü—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞"
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `renderItemThumb` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ü–≤–µ—Ç–Ω—ã–µ –±–µ–π–¥–∂–∏ –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è —Ç–∏–ø–∞ –ø—Ä–∏–≤—è–∑–∫–∏ (—Å–∏–Ω–∏–π - –∫–ª–∞—Å—Ç–µ—Ä—ã, –æ—Ä–∞–Ω–∂–µ–≤—ã–π - —Ä—É—á–Ω—ã–µ, —Å–µ—Ä—ã–π - –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, –∑–µ–ª–µ–Ω—ã–π - —Ñ–∞–π–ª)
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —è–∫–æ—Ä–µ–π URL –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω—É–∂–Ω—É—é –∑–∞–∫–ª–∞–¥–∫—É (`#faces-archive`, `#rectangles-run` –∏ —Ç.–¥.)
  - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_person_api.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API –±–µ–∑ UI
- ‚úÖ **–≠–¢–ê–ü 3.4b (–ó–∞–¥–∞—á–∞ B4.1)**: –ö–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
  - **–§–æ—Ç–æ–∞—Ä—Ö–∏–≤**: –ê–≤–∞—Ç–∞—Ä (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å person_detail), –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π, –ù–∞–∑–Ω–∞—á–∏—Ç—å/–ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω—É, —Ç–∏–ø –ø—Ä–∏–≤—è–∑–∫–∏, —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –£–¥–∞–ª–∏—Ç—å rectangle
  - **–°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π, –ö–æ—Ç, –ù–µ –ª–∏—Ü–æ (—É–¥–∞–ª–µ–Ω–∏–µ rectangle), –î—Ä—É–≥–æ–π (–≤—ã–ø–∞–¥–∞—à–∫–∞ –ø–µ—Ä—Å–æ–Ω)
  - –í `list_context` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è `tab` –∏ `person_id` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å person_detail; —Ä–µ–∂–∏–º –∑–∞–¥–∞—ë—Ç—Å—è –ø–æ `tab` –∏–ª–∏ –ø–æ `file_path`
  - –ù–∞ —Å–µ—Ç–∫–µ –ø–µ—Ä—Å–æ–Ω—ã –∫–Ω–æ–ø–∫–∞ ¬´–ê–≤–∞—Ç–∞—Ä¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ –∞—Ä—Ö–∏–≤–∞ (`item.is_archive`)
- ‚úÖ **–≠–¢–ê–ü 3.5 (–ó–∞–¥–∞—á–∞ C1, C2)**: –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤:
  - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä `selectScopeFilter` –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤: "–í—Å–µ (–∞—Ä—Ö–∏–≤ + —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)", "–¢–æ–ª—å–∫–æ –∞—Ä—Ö–∏–≤–Ω—ã–µ", "–¢–æ–ª—å–∫–æ —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ"
  - –û–±–Ω–æ–≤–ª–µ–Ω API `api_face_clusters_list` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `show_run_only` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ —Ç–∏–ø—É (üì¶ –ê—Ä—Ö–∏–≤ / üîÑ –°–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è) –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
  - –û–±–Ω–æ–≤–ª–µ–Ω —Å—á–µ—Ç—á–∏–∫ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –∞—Ä—Ö–∏–≤/–ø—Ä–æ–≥–æ–Ω –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "–í—Å–µ"
  - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞
- ‚úÖ **–≠–¢–ê–ü 3.6 (–ó–∞–¥–∞—á–∞ D1-D3)**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è `photoCardClosed` –≤ `closePhotoCard()` –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ `source_page === 'person_detail'`)
  - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `photoCardClosed` –≤ `person_detail.html` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
  - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `focusOnRectangle()` –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –Ω—É–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ `file_id` + `rectangle_id`
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è data-–∞—Ç—Ä–∏–±—É—Ç—ã (`data-file-id`, `data-face-id`, `data-person-rectangle-id`) –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ (—Å–∏–Ω—è—è —Ä–∞–º–∫–∞ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã)